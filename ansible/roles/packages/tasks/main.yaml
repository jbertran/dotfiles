---

- name: include OS-specific package names
  include_vars:
    file: vars/{{ ansible_os_family | lower }}.yaml
  when: "{{ ansible_os_family | lower }}" in "{{ supported_os }}"

- name: install basic packages
  package:
    name: "{{ item }}"
    state: present
  loop: "{{ system_packages }}"
  become: true

- name: upgrade pip
  pip:
    name: pip
    state: forcereinstall
    executable: pip3
  become: true

- name: install pip packages
  pip:
    name: "{{ os_packages + pip_packages['common'] }}"
    state: latest
    executable: /usr/local/bin/pip3
    extra_args: --user
  become: true
  vars:
    os_packages: "{{ pip_packages[ansible_os_family] | default([]) }}"
